{% extends "base.html" %}

{% block title %}Quiz Grading - Teacher - EduPlatform{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="display-6 fw-bold text-gradient-primary mb-1">Quiz Grading</h1>
                    <p class="text-muted mb-0">Grade student quiz submissions that require manual review</p>
                </div>
                <div>
                    <button class="btn btn-outline-info me-2" onclick="refreshGrading()">
                        <i class="fas fa-sync-alt me-2"></i>Refresh
                    </button>
                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-outline-primary active" id="pendingBtn" onclick="showPendingGrading()">
                            <i class="fas fa-clock me-2"></i>Pending
                            <span class="badge bg-warning ms-2" id="pendingCount">0</span>
                        </button>
                        <button type="button" class="btn btn-outline-success" id="completedBtn" onclick="showCompletedGrading()">
                            <i class="fas fa-check me-2"></i>Completed
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="pendingSection">
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-exclamation-triangle me-2 text-warning"></i>
                            Pending Manual Grading
                        </h5>
                    </div>
                    <div class="card-body">
                        <div id="pendingGradingContainer">
                            <div class="text-center py-4">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="completedSection" class="d-none">
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="fas fa-check-circle me-2 text-success"></i>
                            Recently Graded Quizzes
                        </h5>
                    </div>
                    <div class="card-body">
                        <div id="completedGradingContainer">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="gradingModal" tabindex="-1" data-bs-backdrop="static">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header bg-gradient-primary text-white">
                <h5 class="modal-title">
                    <i class="fas fa-edit me-2"></i>Grade Quiz Attempt
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                <div id="gradingContent">
                    <div class="text-center py-4">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i>Close
                </button>
                <button type="button" class="btn btn-success" id="saveGradingBtn" onclick="saveAllGrading()" disabled>
                    <i class="fas fa-save me-2"></i>Save All Grades
                </button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="bulkGradingModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Bulk Grading Action</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p>Apply grading to multiple answers:</p>
                <div class="mb-3">
                    <label class="form-label">Action:</label>
                    <select class="form-select" id="bulkAction">
                        <option value="">Select action...</option>
                        <option value="correct_full">Mark as Correct (Full Points)</option>
                        <option value="incorrect_zero">Mark as Incorrect (Zero Points)</option>
                        <option value="partial">Partial Credit...</option>
                    </select>
                </div>
                <div class="mb-3 d-none" id="partialPointsContainer">
                    <label class="form-label">Points to Award:</label>
                    <input type="number" class="form-control" id="partialPoints" min="0" step="0.5">
                </div>
                <div class="mb-3">
                    <label class="form-label">Selected Answers:</label>
                    <div id="selectedAnswersList" class="small text-muted">
                        No answers selected
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="applyBulkGrading()">Apply</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
let pendingAttempts = [];
let currentAttempt = null;
let gradingChanges = [];
let selectedAnswers = [];

document.addEventListener('DOMContentLoaded', function() {
    loadPendingGrading();
    
    document.getElementById('bulkAction').addEventListener('change', function() {
        const partialContainer = document.getElementById('partialPointsContainer');
        if (this.value === 'partial') {
            partialContainer.classList.remove('d-none');
        } else {
            partialContainer.classList.add('d-none');
        }
    });
});

async function loadPendingGrading() {
    try {
        const response = await fetch('/api/quiz-grading/pending', {
            headers: {
                'Authorization': `Bearer {{ session.access_token }}`,
                'Content-Type': 'application/json'
            }
        });
        
        if (response.ok) {
            const data = await response.json();
            pendingAttempts = data.data?.pending_attempts || data.pending_attempts || [];
            displayPendingGrading();
            updatePendingCount();
        } else {
            showError('Failed to load pending grading');
        }
    } catch (error) {
        console.error('Error loading pending grading:', error);
        showError('Error loading pending grading');
    }
}

function displayPendingGrading() {
    const container = document.getElementById('pendingGradingContainer');
    
    if (pendingAttempts.length === 0) {
        container.innerHTML = `
            <div class="text-center py-5">
                <i class="fas fa-check-circle fa-3x text-success mb-3"></i>
                <h5 class="text-success">All Caught Up!</h5>
                <p class="text-muted">No quiz submissions require manual grading at this time.</p>
                <button class="btn btn-outline-primary" onclick="refreshGrading()">
                    <i class="fas fa-sync-alt me-2"></i>Check for New Submissions
                </button>
            </div>
        `;
        return;
    }
    
    let content = '<div class="row g-4">';
    
    pendingAttempts.forEach(attempt => {
        const urgencyClass = getUrgencyClass(attempt.submitted_at);
        const timeAgo = formatTimeAgo(new Date(attempt.submitted_at));
        
        content += `
            <div class="col-lg-6 col-xl-4">
                <div class="card h-100 border-${urgencyClass}">
                    <div class="card-header bg-${urgencyClass} bg-opacity-10">
                        <div class="d-flex justify-content-between align-items-start">
                            <h6 class="card-title mb-0">${attempt.quiz_title}</h6>
                            <span class="badge bg-${urgencyClass}">${attempt.total_ungraded} pending</span>
                        </div>
                        <small class="text-muted">${attempt.course_title}</small>
                    </div>
                    <div class="card-body">
                        <div class="d-flex align-items-center mb-3">
                            <div class="avatar bg-gradient-secondary rounded-circle me-3 d-flex align-items-center justify-content-center" style="width: 40px; height: 40px;">
                                <i class="fas fa-user text-white"></i>
                            </div>
                            <div>
                                <div class="fw-semibold">${attempt.student_name}</div>
                                <small class="text-muted">Submitted ${timeAgo}</small>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <div class="d-flex justify-content-between align-items-center mb-1">
                                <small class="text-muted">Current Score</small>
                                <span class="fw-bold">${attempt.current_score?.toFixed(1) || 0}%</span>
                            </div>
                            <div class="progress" style="height: 6px;">
                                <div class="progress-bar bg-secondary" style="width: ${attempt.current_score || 0}%"></div>
                            </div>
                            <small class="text-muted">Preliminary score (before manual grading)</small>
                        </div>
                        
                        <div class="mb-3">
                            <h6 class="small fw-semibold mb-2">Questions Requiring Grading:</h6>
                            ${attempt.ungraded_questions.slice(0, 2).map(q => `
                                <div class="bg-light rounded p-2 mb-2">
                                    <div class="small fw-semibold">${q.question_text.substring(0, 60)}${q.question_text.length > 60 ? '...' : ''}</div>
                                    <div class="small text-muted">${q.points} points</div>
                                </div>
                            `).join('')}
                            ${attempt.ungraded_questions.length > 2 ? `
                                <div class="small text-muted">+ ${attempt.ungraded_questions.length - 2} more questions</div>
                            ` : ''}
                        </div>
                        
                        <div class="d-grid">
                            <button class="btn btn-gradient-primary" onclick="openGradingModal(${attempt.attempt_id})">
                                <i class="fas fa-edit me-2"></i>Grade Now
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        `;
    });
    
    content += '</div>';
    container.innerHTML = content;
}

async function openGradingModal(attemptId) {
    try {
        const response = await fetch(`/api/quiz-grading/attempt/${attemptId}`, {
            headers: {
                'Authorization': `Bearer {{ session.access_token }}`,
                'Content-Type': 'application/json'
            }
        });
        
        if (response.ok) {
            const data = await response.json();
            currentAttempt = data.data || data;
            displayGradingContent();
            new bootstrap.Modal(document.getElementById('gradingModal')).show();
        } else {
            showError('Failed to load grading details');
        }
    } catch (error) {
        console.error('Error loading grading details:', error);
        showError('Error loading grading details');
    }
}

function displayGradingContent() {
    if (!currentAttempt) return;
    
    const content = document.getElementById('gradingContent');
    const attempt = currentAttempt.attempt;
    const student = currentAttempt.student;
    const quiz = currentAttempt.quiz;
    const questions = currentAttempt.questions;
    
    gradingChanges = []; 
    selectedAnswers = []; 
    
    let html = `
        <div class="row mb-4">
            <div class="col-md-8">
                <h5>${quiz.title}</h5>
                <p class="text-muted mb-1">Student: ${student.full_name}</p>
                <p class="text-muted mb-1">Submitted: ${new Date(attempt.submitted_at).toLocaleString()}</p>
                <p class="text-muted">Current Score: ${attempt.score?.toFixed(1) || 0}%</p>
            </div>
            <div class="col-md-4 text-end">
                <div class="d-flex gap-2 justify-content-end">
                    <button class="btn btn-outline-secondary btn-sm" onclick="selectAllAnswers()">
                        <i class="fas fa-check-square me-1"></i>Select All
                    </button>
                    <button class="btn btn-outline-warning btn-sm" onclick="openBulkGrading()" disabled id="bulkGradeBtn">
                        <i class="fas fa-edit me-1"></i>Bulk Grade
                    </button>
                </div>
            </div>
        </div>
        
        <div class="grading-questions">
    `;
    
    questions.forEach((question, index) => {
        const needsGrading = question.needs_grading;
        const isCorrect = question.is_correct;
        
        html += `
            <div class="card mb-3 ${needsGrading ? 'border-warning' : ''}">
                <div class="card-header ${needsGrading ? 'bg-warning bg-opacity-10' : ''}">
                    <div class="d-flex justify-content-between align-items-center">
                        <h6 class="mb-0">
                            Question ${index + 1}
                            ${needsGrading ? '<span class="badge bg-warning ms-2">Needs Grading</span>' : ''}
                        </h6>
                        <div class="d-flex align-items-center">
                            ${needsGrading ? `
                                <div class="form-check me-3">
                                    <input class="form-check-input" type="checkbox" id="select_${question.answer_id}" 
                                           onchange="toggleAnswerSelection(${question.answer_id})">
                                    <label class="form-check-label" for="select_${question.answer_id}">
                                        Select
                                    </label>
                                </div>
                            ` : ''}
                            <span class="badge bg-primary">${question.points} points</span>
                        </div>
                    </div>
                </div>
                <div class="card-body">
                    <div class="question-text mb-3">
                        <strong>${question.question_text}</strong>
                    </div>
                    
                    ${question.question_type === 'short_answer' ? `
                        <div class="row">
                            <div class="col-md-8">
                                <h6 class="text-muted">Student Answer:</h6>
                                <div class="bg-light rounded p-3 mb-3">
                                    ${question.student_answer || '<em class="text-muted">No answer provided</em>'}
                                </div>
                                
                                ${needsGrading ? `
                                    <div class="grading-controls" id="grading_${question.answer_id}">
                                        <h6>Grade This Answer:</h6>
                                        <div class="row g-2">
                                            <div class="col-md-6">
                                                <div class="btn-group w-100" role="group">
                                                    <input type="radio" class="btn-check" name="grade_${question.answer_id}" 
                                                           id="correct_${question.answer_id}" value="correct">
                                                    <label class="btn btn-outline-success" for="correct_${question.answer_id}">
                                                        <i class="fas fa-check me-1"></i>Correct
                                                    </label>
                                                    
                                                    <input type="radio" class="btn-check" name="grade_${question.answer_id}" 
                                                           id="incorrect_${question.answer_id}" value="incorrect">
                                                    <label class="btn btn-outline-danger" for="incorrect_${question.answer_id}">
                                                        <i class="fas fa-times me-1"></i>Incorrect
                                                    </label>
                                                    
                                                    <input type="radio" class="btn-check" name="grade_${question.answer_id}" 
                                                           id="partial_${question.answer_id}" value="partial">
                                                    <label class="btn btn-outline-warning" for="partial_${question.answer_id}">
                                                        <i class="fas fa-adjust me-1"></i>Partial
                                                    </label>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="input-group">
                                                    <span class="input-group-text">Points:</span>
                                                    <input type="number" class="form-control" id="points_${question.answer_id}" 
                                                           min="0" max="${question.points}" step="0.5" value="${question.points_earned || 0}">
                                                    <span class="input-group-text">/${question.points}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                ` : ''}
                            </div>
                            <div class="col-md-4">
                                <div class="card bg-light">
                                    <div class="card-body text-center">
                                        <h6>Current Grade</h6>
                                        <div class="h4 text-${isCorrect === true ? 'success' : isCorrect === false ? 'danger' : 'warning'}">
                                            ${question.points_earned || 0}/${question.points}
                                        </div>
                                        <small class="text-muted">
                                            ${isCorrect === true ? 'Correct' : 
                                              isCorrect === false ? 'Incorrect' : 
                                              'Pending'}
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    ` : `
                        <!-- Multiple choice/True-false display -->
                        <div class="options mb-3">
                            ${question.options?.map(option => `
                                <div class="p-2 mb-2 border rounded ${
                                    option.is_correct ? 'border-success bg-success bg-opacity-10' : 
                                    option.selected ? 'border-danger bg-danger bg-opacity-10' : 'border-light'
                                }">
                                    ${option.is_correct ? '<i class="fas fa-check text-success me-2"></i>' : 
                                      option.selected ? '<i class="fas fa-times text-danger me-2"></i>' : 
                                      '<i class="fas fa-circle text-muted me-2"></i>'}
                                    ${option.option_text}
                                    ${option.is_correct ? '<span class="badge bg-success ms-2">Correct</span>' : ''}
                                    ${option.selected && !option.is_correct ? '<span class="badge bg-danger ms-2">Selected</span>' : ''}
                                    ${option.selected && option.is_correct ? '<span class="badge bg-success ms-2">Selected âœ“</span>' : ''}
                                </div>
                            `).join('') || ''}
                        </div>
                        <div class="alert alert-${isCorrect ? 'success' : 'danger'} mb-0">
                            <strong>Auto-graded:</strong> ${isCorrect ? 'Correct' : 'Incorrect'} 
                            (${question.points_earned || 0}/${question.points} points)
                        </div>
                    `}
                </div>
            </div>
        `;
    });
    
    html += '</div>';
    content.innerHTML = html;
    
    questions.forEach(question => {
        if (question.needs_grading) {
            const gradeRadios = document.querySelectorAll(`input[name="grade_${question.answer_id}"]`);
            const pointsInput = document.getElementById(`points_${question.answer_id}`);
            
            gradeRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    updateGrading(question.answer_id, this.value, question.points);
                });
            });
            
            pointsInput.addEventListener('input', function() {
                updateGradingPoints(question.answer_id, parseFloat(this.value));
            });
        }
    });
    
    updateSaveButton();
}

function updateGrading(answerId, gradeType, maxPoints) {
    const pointsInput = document.getElementById(`points_${answerId}`);
    let points = 0;
    let isCorrect = false;
    
    switch (gradeType) {
        case 'correct':
            points = maxPoints;
            isCorrect = true;
            break;
        case 'incorrect':
            points = 0;
            isCorrect = false;
            break;
        case 'partial':
            points = parseFloat(pointsInput.value) || 0;
            isCorrect = points > 0;
            break;
    }
    
    pointsInput.value = points;
    
    const existingIndex = gradingChanges.findIndex(change => change.answer_id === answerId);
    const change = {
        answer_id: answerId,
        is_correct: isCorrect,
        points_awarded: points
    };
    
    if (existingIndex >= 0) {
        gradingChanges[existingIndex] = change;
    } else {
        gradingChanges.push(change);
    }
    
    updateSaveButton();
}

function updateGradingPoints(answerId, points) {
    const existingIndex = gradingChanges.findIndex(change => change.answer_id === answerId);
    if (existingIndex >= 0) {
        gradingChanges[existingIndex].points_awarded = points;
        gradingChanges[existingIndex].is_correct = points > 0;
    }
    updateSaveButton();
}

function toggleAnswerSelection(answerId) {
    const checkbox = document.getElementById(`select_${answerId}`);
    if (checkbox.checked) {
        selectedAnswers.push(answerId);
    } else {
        selectedAnswers = selectedAnswers.filter(id => id !== answerId);
    }
    
    updateBulkGradeButton();
    updateSelectedAnswersList();
}

function selectAllAnswers() {
    const checkboxes = document.querySelectorAll('input[id^="select_"]');
    const allChecked = Array.from(checkboxes).every(cb => cb.checked);
    
    checkboxes.forEach(checkbox => {
        checkbox.checked = !allChecked;
        const answerId = parseInt(checkbox.id.replace('select_', ''));
        if (!allChecked && !selectedAnswers.includes(answerId)) {
            selectedAnswers.push(answerId);
        }
    });
    
    if (allChecked) {
        selectedAnswers = [];
    }
    
    updateBulkGradeButton();
    updateSelectedAnswersList();
}

function updateBulkGradeButton() {
    const bulkBtn = document.getElementById('bulkGradeBtn');
    bulkBtn.disabled = selectedAnswers.length === 0;
}

function updateSelectedAnswersList() {
    const list = document.getElementById('selectedAnswersList');
    if (selectedAnswers.length === 0) {
        list.textContent = 'No answers selected';
        list.className = 'small text-muted';
    } else {
        list.textContent = `${selectedAnswers.length} answer(s) selected`;
        list.className = 'small text-primary';
    }
}

function openBulkGrading() {
    if (selectedAnswers.length === 0) return;
    
    updateSelectedAnswersList();
    new bootstrap.Modal(document.getElementById('bulkGradingModal')).show();
}

function applyBulkGrading() {
    const action = document.getElementById('bulkAction').value;
    const partialPoints = parseFloat(document.getElementById('partialPoints').value) || 0;
    
    if (!action) {
        showError('Please select an action');
        return;
    }
    
    selectedAnswers.forEach(answerId => {
        const question = currentAttempt.questions.find(q => q.answer_id === answerId);
        if (!question) return;
        
        let isCorrect = false;
        let points = 0;
        
        switch (action) {
            case 'correct_full':
                isCorrect = true;
                points = question.points;
                break;
            case 'incorrect_zero':
                isCorrect = false;
                points = 0;
                break;
            case 'partial':
                isCorrect = partialPoints > 0;
                points = Math.min(partialPoints, question.points);
                break;
        }
        
        const correctRadio = document.getElementById(`correct_${answerId}`);
        const incorrectRadio = document.getElementById(`incorrect_${answerId}`);
        const partialRadio = document.getElementById(`partial_${answerId}`);
        const pointsInput = document.getElementById(`points_${answerId}`);
        
        if (action === 'correct_full') {
            correctRadio.checked = true;
        } else if (action === 'incorrect_zero') {
            incorrectRadio.checked = true;
        } else {
            partialRadio.checked = true;
        }
        
        pointsInput.value = points;
        
        updateGrading(answerId, action === 'partial' ? 'partial' : action === 'correct_full' ? 'correct' : 'incorrect', question.points);
    });
    
    selectedAnswers = [];
    document.querySelectorAll('input[id^="select_"]').forEach(cb => cb.checked = false);
    updateBulkGradeButton();
    
    bootstrap.Modal.getInstance(document.getElementById('bulkGradingModal')).hide();
    showSuccess(`Applied bulk grading to ${selectedAnswers.length} answers`);
}

function updateSaveButton() {
    const saveBtn = document.getElementById('saveGradingBtn');
    saveBtn.disabled = gradingChanges.length === 0;
}

async function saveAllGrading() {
    if (gradingChanges.length === 0) {
        showError('No changes to save');
        return;
    }
    
    try {
        const saveBtn = document.getElementById('saveGradingBtn');
        saveBtn.disabled = true;
        saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Saving...';
        
        const response = await fetch('/api/quiz-grading/bulk-grade', {
            method: 'POST',
            headers: {
                'Authorization': `Bearer {{ session.access_token }}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                grading_data: gradingChanges
            })
        });
        
        if (response.ok) {
            const result = await response.json();
            showSuccess(`Successfully graded ${result.data?.total_graded || gradingChanges.length} answers`);
            
            bootstrap.Modal.getInstance(document.getElementById('gradingModal')).hide();
            loadPendingGrading(); 
        } else {
            const error = await response.json();
            showError(error.error || 'Failed to save grading');
        }
    } catch (error) {
        console.error('Error saving grading:', error);
        showError('Error saving grading');
    } finally {
        const saveBtn = document.getElementById('saveGradingBtn');
        saveBtn.disabled = false;
        saveBtn.innerHTML = '<i class="fas fa-save me-2"></i>Save All Grades';
    }
}

function showPendingGrading() {
    document.getElementById('pendingSection').classList.remove('d-none');
    document.getElementById('completedSection').classList.add('d-none');
    
    document.getElementById('pendingBtn').classList.add('active');
    document.getElementById('completedBtn').classList.remove('active');
}

function showCompletedGrading() {
    document.getElementById('pendingSection').classList.add('d-none');
    document.getElementById('completedSection').classList.remove('d-none');
    
    document.getElementById('pendingBtn').classList.remove('active');
    document.getElementById('completedBtn').classList.add('active');
    
    loadCompletedGrading();
}

async function loadCompletedGrading() {
    const container = document.getElementById('completedGradingContainer');
    container.innerHTML = `
        <div class="text-center py-4">
            <i class="fas fa-info-circle fa-2x text-muted mb-3"></i>
            <h6 class="text-muted">Grading History</h6>
            <p class="text-muted">Recently graded quiz submissions will appear here</p>
        </div>
    `;
}

function refreshGrading() {
    loadPendingGrading();
}

function updatePendingCount() {
    const count = pendingAttempts.length;
    document.getElementById('pendingCount').textContent = count;
}

function getUrgencyClass(submittedAt) {
    const now = new Date();
    const submitted = new Date(submittedAt);
    const hoursDiff = (now - submitted) / (1000 * 60 * 60);
    
    if (hoursDiff > 48) return 'danger';
    if (hoursDiff > 24) return 'warning';
    return 'info';
}

function formatTimeAgo(date) {
    const now = new Date();
    const diffMs = now - date;
    const diffMins = Math.floor(diffMs / 60000);
    const diffHours = Math.floor(diffMs / 3600000);
    const diffDays = Math.floor(diffMs / 86400000);
    
    if (diffMins < 60) return `${diffMins} min ago`;
    if (diffHours < 24) return `${diffHours}h ago`;
    return `${diffDays}d ago`;
}

function showError(message) {
    const alertContainer = document.querySelector('.container-fluid');
    const alert = document.createElement('div');
    alert.className = 'alert alert-danger alert-dismissible fade show';
    alert.innerHTML = `
        <i class="fas fa-exclamation-triangle me-2"></i>
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    alertContainer.insertBefore(alert, alertContainer.firstChild);
    setTimeout(() => alert.remove(), 5000);
}

function showSuccess(message) {
    const alertContainer = document.querySelector('.container-fluid');
    const alert = document.createElement('div');
    alert.className = 'alert alert-success alert-dismissible fade show';
    alert.innerHTML = `
        <i class="fas fa-check-circle me-2"></i>
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    alertContainer.insertBefore(alert, alertContainer.firstChild);
    setTimeout(() => alert.remove(), 5000);
}